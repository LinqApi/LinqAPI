var g=class{constructor(e="",{filter:t=new b("AND"),pager:s=new f,orderBy:r="id",desc:a=!0,groupBy:i="",select:n="",includes:c=[]}={}){this.controller=e,this.filter=t,this.pager=s,this.orderBy=r,this.desc=a,this.groupBy=i,this.select=n,this.includes=c}toPayload(){return{filter:this.filter.toString(),pager:this.pager,orderBy:this.orderBy,desc:this.desc,groupBy:this.groupBy,select:this.select,includes:this.includes.map(e=>e.toPayload())}}},B=class{constructor(e,t=new f,s=[]){this.propertyName=e,this.pager=t,this.thenIncludes=s}toPayload(){return{propertyName:this.propertyName,pager:this.pager,thenIncludes:this.thenIncludes.map(e=>e.toPayload())}}},N=class{constructor(e,t=[],s=new f){this.parentProperty=e,this.childIncludes=t,this.pager=s}toPayload(){return{parentProperty:this.parentProperty,childIncludes:this.childIncludes,pager:this.pager}}},f=class{constructor(e=1,t=10){this.pageNumber=e,this.pageSize=t}},x=class{toString(){return""}},b=class extends x{constructor(e="AND",t=[]){super(),this.operator=e,this.filters=t}toString(){if(!this.filters.length)return"1=1";let e=this.filters.map(t=>t.toString()).join(` ${this.operator} `);return this.filters.length>1?`(${e})`:e}},k=class extends x{constructor(e,t,s){super(),this.field=e,this.operator=t,this.value=s}toString(){return`${this.field} ${this.operator} ${this.value}`}};var v=class{static createForm(e,t,s={},r={mode:"Create"}){let a=document.createElement("div");a.className="card card-body collapse mb-3";let i={},n=["string","int64","boolean","datetime","int32"];t.forEach(h=>{if(h.type.includes("ICollection")||h.name==="Id")return;let o=h.type.toLowerCase();if(!n.some(y=>o.includes(y)))return;let u=document.createElement("label");u.textContent=h.name;let m=document.createElement("input");m.type="text",m.className="form-control mb-2",m.value=s[h.name]||"",a.appendChild(u),a.appendChild(m),i[h.name]=m});let c=document.createElement("div");c.className="d-flex justify-content-end gap-2";let l=document.createElement("button");l.className="btn btn-success me-2",l.innerHTML='<i class="bi bi-check-circle"></i>',l.addEventListener("click",()=>{let h={};for(let o in i)h[o]=i[o].value;typeof r.onSave=="function"&&r.onSave(h),a.classList.remove("show"),a.classList.add("collapse")});let d=document.createElement("button");return d.className="btn btn-danger",d.innerHTML='<i class="bi bi-x-circle"></i>',d.addEventListener("click",()=>{a.classList.remove("show"),a.classList.add("collapse")}),c.appendChild(l),c.appendChild(d),a.appendChild(c),e.insertBefore(a,e.firstChild),a}},q=(p,e=300)=>{let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>p(...s),e)}},E={apiPrefix:"/api",propertiesRoute:"properties",filterPagedRoute:"filterpaged",defaultPageSize:10,debounceDuration:300},H=({searchProperty:p,query:e,filterSuffix:t=""})=>{let s=e?`${p}.Contains("${e}")`:"";return t?s?`${t} AND ${s}`:t:s||"1=1"},I=async(p,e)=>{let s=await(await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.toPayload())})).json();return{items:s.items||s.$values||[],totalCount:s.totalRecords||0}},_=p=>{let e=/^(ICollection|IList|IReadOnlyCollection)<\s*(.+)\s*>$/i,t=p.match(e);if(t)return{kind:"complexList",baseType:t[2].trim()};let s=["string","int64","boolean","datetime","int32"],r=p.toLowerCase();return s.some(a=>r.includes(a))?{kind:"simple",baseType:p}:{kind:"complex",baseType:p}},w=async(p,e="/api")=>{let t=`${e.replace(/\/+$/,"")}/${p}/properties`;return fetch(t).then(s=>{if(!s.ok)throw new Error(`fetchProperties request failed: ${s.status}`);return s.json()}).then(s=>s.map(i=>{let n=_(i.type);return{...i,kind:n.kind,baseType:n.baseType,displayProperties:i.displayProperties||[]}}).filter(i=>typeof i.type=="string"&&i.type.toLowerCase()!=="displayproperty")).catch(s=>{throw console.error("fetchProperties error:",s),s})};var P=class{constructor(e={}){this.state=e,this.listeners=new Map}getState(){return this.state}setState(e){this.state={...this.state,...e},this.notify()}subscribe(e,t){if(typeof t!="function")throw new Error("Listener must be a function");return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.listeners.get(e).delete(t)}}notify(){for(let[e,t]of this.listeners.entries()){let s=this.state[e];t.forEach(r=>r(s))}}};var S=class{constructor({container:e,stateManager:t,controller:s,apiPrefix:r="/api",properties:a=null}){if(this.stateManager=t,this.controller=s,this.apiPrefix=r,this.containerElm=typeof e=="string"?document.querySelector(e):e,!this.containerElm)throw new Error("QueryBuilder: Invalid container.");this.query=this.stateManager.getState("query")||new g(s,{filter:new b("AND",[{toString:()=>"1=1"}]),pager:new f,orderBy:"id",desc:!0,groupBy:"",select:"",includes:[]}),this.properties=a,this.properties||w(this.controller,this.apiPrefix).then(i=>{this.properties=i}).catch(i=>console.error("Failed to fetch properties:",i)),this._render(),this.stateManager.subscribe("query",i=>{this.query=i,this._updateUI()})}_render(){this.containerElm.innerHTML="";let e=document.createElement("div");e.className="row mb-3";let t=document.createElement("div");t.className="col-md-6";let s=document.createElement("label");s.textContent="Filter:",s.className="form-label",this.filterInput=document.createElement("input"),this.filterInput.type="text",this.filterInput.className="form-control",this.filterInput.value=this.query&&this.query.filter&&this.query.filter.toString()||"1=1",t.appendChild(s),t.appendChild(this.filterInput),e.appendChild(t);let r=document.createElement("div");r.className="col-md-6";let a=document.createElement("label");a.textContent="Select:",a.className="form-label",this.selectInput=document.createElement("input"),this.selectInput.type="text",this.selectInput.className="form-control",this.selectInput.value=this.query&&this.query.select||"",r.appendChild(a),r.appendChild(this.selectInput),e.appendChild(r),this.containerElm.appendChild(e);let i=document.createElement("div");i.className="row mb-3";let n=document.createElement("div");n.className="col-md-6";let c=document.createElement("label");c.textContent="GroupBy:",c.className="form-label",this.groupByInput=document.createElement("input"),this.groupByInput.type="text",this.groupByInput.className="form-control",this.groupByInput.value=this.query&&this.query.groupBy||"",n.appendChild(c),n.appendChild(this.groupByInput),i.appendChild(n);let l=document.createElement("div");l.className="col-md-6";let d=document.createElement("label");d.textContent="OrderBy:",d.className="form-label",this.orderByInput=document.createElement("input"),this.orderByInput.type="text",this.orderByInput.className="form-control",this.orderByInput.value=this.query&&this.query.orderBy||"id",l.appendChild(d),l.appendChild(this.orderByInput),i.appendChild(l),this.containerElm.appendChild(i);let h=document.createElement("div");h.className="row mb-3 align-items-center";let o=document.createElement("div");o.className="col-md-6";let u=document.createElement("div");u.className="form-check",this.descInput=document.createElement("input"),this.descInput.type="checkbox",this.descInput.className="form-check-input",this.descInput.checked=this.query&&typeof this.query.desc=="boolean"?this.query.desc:!0;let m=document.createElement("label");m.textContent="Desc:",m.className="form-check-label",u.appendChild(this.descInput),u.appendChild(m),o.appendChild(u),h.appendChild(o);let y=document.createElement("div");y.className="col-md-6 text-end",this.applyBtn=document.createElement("button"),this.applyBtn.textContent="Uygula",this.applyBtn.className="btn btn-primary",this.applyBtn.addEventListener("click",()=>this._applyQuery()),y.appendChild(this.applyBtn),h.appendChild(y),this.containerElm.appendChild(h)}_applyQuery(){let e={filter:new b("AND",[{toString:()=>this.filterInput.value?this.filterInput.value:"1=1"}]),select:this.selectInput.value||"",groupBy:this.groupByInput.value||"",orderBy:this.orderByInput.value||"id",desc:!!this.descInput.checked};this.stateManager.setState({query:new g(this.controller,e)})}_updateUI(){this.filterInput.value=this.query&&this.query.filter&&this.query.filter.toString()||"1=1",this.selectInput.value=this.query&&this.query.select||"",this.groupByInput.value=this.query&&this.query.groupBy||"",this.orderByInput.value=this.query&&this.query.orderBy||"id",this.descInput.checked=this.query&&typeof this.query.desc=="boolean"?this.query.desc:!0}onQueryUpdated(e){this.query=e,this.query.select=this.selectInput.value,this.query.groupBy=this.groupByInput.value,this.query.orderBy=this.orderByInput.value,this.query.desc=this.descInput.checked,this.query.pager=e.Pager}};var L=class{constructor(e){this.cfg={container:null,controller:"",apiPrefix:E.apiPrefix,searchProperty:"name",displayProperty:"name",valueField:"id",filterSuffix:"",renderMode:"tag",fetchMode:"server",selectPlaceHolder:"Select...",localData:[],multiselect:!1,pageSize:E.defaultPageSize,debounceDuration:E.debounceDuration,disabled:!1,...e},this.selectedItems=[],this.init()}init(){this.container=this.cfg.container,this.container.style.position="relative",window.addEventListener("resize",()=>{this.dropdown.style.top="100%"}),this.container.innerHTML=`
        <div class="select2-wrapper" style="position: relative;">
            <input class="form-control mb-1" placeholder="${this.cfg.placeholder||"Select..."}" />
            <div class="dropdown-menu w-100"></div>
        </div>
        <div class="selected-items mt-2"></div>
    `;let e=this.container.querySelector(".select2-wrapper");[this.input,this.dropdown]=e.children,this.selectedContainer=this.container.querySelector(".selected-items"),Object.assign(this.dropdown.style,{position:"absolute",top:"100%",left:"0",zIndex:"1000"}),this.cfg.disabled?(this.input.disabled=!0,this.dropdown.classList.remove("show")):(this.input.oninput=q(()=>this.fetchData(this.input.value),this.cfg.debounceDuration),this.input.onfocus=()=>this.fetchData(""),document.addEventListener("click",t=>{this.container.contains(t.target)||this.dropdown.classList.remove("show")}))}async fetchData(e){if(this.cfg.fetchMode==="server"){let t=`${this.cfg.apiPrefix}/${this.cfg.controller}/${E.filterPagedRoute}`,s=[];e&&s.push(`${this.cfg.searchProperty}.Contains("${e}")`),this.cfg.filterSuffix&&s.push(this.cfg.filterSuffix);let r=new b("AND",s),a=new g(this.cfg.controller,{filter:r,pager:new f(1,this.cfg.pageSize),orderBy:this.cfg.valueField,desc:!1});this.data=await I(t,a)}else{let t=e.toLowerCase();this.data={items:this.cfg.localData.filter(s=>s[this.cfg.searchProperty].toLowerCase().includes(t))}}this.renderDropdown()}renderDropdown(){if(this.cfg.renderMode==="checkbox"){let e='<table class="table table-sm mb-0"><tbody>';this.data.items.forEach((s,r)=>{let a=this.getDisplayText(s),i=this.selectedItems.some(n=>n[this.cfg.valueField]===s[this.cfg.valueField]);e+=`
                <tr>
                    <td style="width: 1%;">
                        <input type="checkbox" data-index="${r}" ${i?"checked":""} />
                    </td>
                    <td>${a}</td>
                </tr>
            `}),e+="</tbody></table>",this.dropdown.innerHTML=e,this.dropdown.querySelectorAll("input[type='checkbox']").forEach(s=>{s.addEventListener("change",r=>{let a=r.target.getAttribute("data-index"),i=this.data.items[a];r.target.checked?this.selectedItems.some(n=>n[this.cfg.valueField]===i[this.cfg.valueField])||this.selectedItems.push(i):this.selectedItems=this.selectedItems.filter(n=>n[this.cfg.valueField]!==i[this.cfg.valueField]),typeof this.cfg.onChange=="function"&&this.cfg.onChange(this.getValue())})}),this.dropdown.classList.add("show")}else this.dropdown.innerHTML=this.data.items.map(e=>`<a class="dropdown-item">${this.getDisplayText(e)}</a>`).join(""),Array.from(this.dropdown.children).forEach((e,t)=>{e.onclick=()=>this.selectItem(this.data.items[t])}),this.dropdown.classList.add("show")}selectItem(e){this.cfg.disabled||(this.cfg.multiselect?this.selectedItems.some(t=>t[this.cfg.valueField]===e[this.cfg.valueField])||this.selectedItems.push(e):this.selectedItems=[e],this.updateSelectedUI(),this.cfg.multiselect||this.dropdown.classList.remove("show"))}updateSelectedUI(){let e=t=>this.getDisplayText(t);this.cfg.multiselect?(this.input.value="",this.cfg.renderMode==="tag"?(this.selectedContainer.innerHTML=this.selectedItems.map(t=>`
                <span class="badge bg-secondary me-1">
                    ${e(t)}
                    <span data-id="${t[this.cfg.valueField]}" class="ms-1" style="cursor: pointer;">&times;</span>
                </span>
            `).join(""),this.selectedContainer.querySelectorAll("[data-id]").forEach(t=>{t.onclick=()=>{this.removeSelected(t.dataset.id),typeof this.cfg.onChange=="function"&&this.cfg.onChange(this.getValue())}})):this.cfg.renderMode==="grid"&&(this.selectedContainer.innerHTML=`
                <table class="table table-bordered small">
                    <tbody>
                        ${this.selectedItems.map(t=>`
                            <tr>
                                <td>${e(t)}</td>
                                <td style="width:1%; white-space: nowrap;">
                                    <button class="btn btn-sm btn-danger" data-id="${t[this.cfg.valueField]}">&times;</button>
                                </td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
            `,this.selectedContainer.querySelectorAll("button[data-id]").forEach(t=>{t.onclick=()=>{this.removeSelected(t.getAttribute("data-id")),typeof this.cfg.onChange=="function"&&this.cfg.onChange(this.getValue())}}))):(this.input.value=this.selectedItems[0]?e(this.selectedItems[0]):"",this.selectedContainer.innerHTML=""),typeof this.cfg.onChange=="function"&&this.cfg.onChange(this.getValue())}removeSelected(e){this.selectedItems=this.selectedItems.filter(t=>t[this.cfg.valueField].toString()!==e.toString()),this.updateSelectedUI()}getValue(){return this.cfg.multiselect?this.selectedItems:this.selectedItems[0]||null}getDisplayText(e){return Array.isArray(this.cfg.displayProperty)?this.cfg.displayProperty.map(t=>e[t]).filter(t=>t!=null).join(" - "):e[this.cfg.displayProperty]??""}};var T=class{constructor({container:e,controller:t,apiPrefix:s="/api",stateManager:r=null,queryBuilderContainer:a=null,autoCreateQueryBuilder:i=!0,select2Columns:n=!1}){if(typeof e=="string"?this.containerElm=document.querySelector(e):this.containerElm=e,!this.containerElm)throw new Error("LinqDataTable: Invalid container element.");this.controller=t,this.apiPrefix=s,this.stateManager=r||new P,this.data=[],this.totalCount=0,this.pageSize=10,this.currentSort=null,this.isLoading=!1,this.entityProperties=null,this.editingIndex=null,this.select2Columns=n,this.selectedColumns=[],this._renderTopControls(),this.tableElm=document.createElement("table"),this.tableElm.className="table table-striped table-hover",this.containerElm.appendChild(this.tableElm),this.pagerElm=document.createElement("div"),this.pagerElm.className="d-flex justify-content-between align-items-center mt-3",this.containerElm.appendChild(this.pagerElm),i&&(this.queryBuilder=new S({container:a,stateManager:this.stateManager,controller:this.controller,apiPrefix:this.apiPrefix}),this.queryBuilder.onQueryUpdated(c=>{this.currentQuery=c,this.currentPage=1,this._fetchData()}),this.stateManager.subscribe("query",c=>{this.currentQuery=c,this.currentPage=1,this._fetchData()})),this.currentQuery=this.stateManager.getState("query")||this.queryBuilder.query,this.currentQuery instanceof g||(this.currentQuery=new g(this.controller,{filter:this.currentQuery.filter||new b("AND",[{toString:()=>"1=1"}]),pager:this.currentQuery.pager||new f,orderBy:this.currentQuery.orderBy||"id",desc:typeof this.currentQuery.desc=="boolean"?this.currentQuery.desc:!0,groupBy:this.currentQuery.groupBy||"",select:this.currentQuery.select||"",includes:this.currentQuery.includes||[]})),this._fetchData()}_renderTopControls(){let e=document.createElement("div");e.className="mb-3";let t=document.createElement("button");t.type="button",t.textContent="Yeni Ekle",t.className="btn btn-primary",t.addEventListener("click",()=>this._openCreateForm()),e.appendChild(t),this.select2Columns&&(this.columnSelectContainer=document.createElement("div"),this.columnSelectContainer.className="mb-2",e.appendChild(this.columnSelectContainer)),this.containerElm.appendChild(e)}_createColumnSelector(){let t=this.entityProperties.filter(s=>s.type.toLowerCase()!=="displayproperty").map(s=>({id:s.name,name:s.name}));if(this.columnSelector=new L({container:this.columnSelectContainer,controller:"",multiselect:!0,renderMode:"checkbox",fetchMode:"client",localData:t,displayProperty:"name",valueField:"id",selectPlaceHolder:"Select columns...",onChange:s=>{this.selectedColumns=s.map(r=>r.id),this._renderTable()}}),t.length>0){let s=t.find(n=>n.id.toLowerCase()==="id"),r=t.filter(n=>n.id.toLowerCase()!=="id"),a=8-(s?1:0),i=r.slice(0,a);this.selectedColumns=[],s&&this.selectedColumns.push(s.id),i.forEach(n=>this.selectedColumns.push(n.id)),this.columnSelector.selectedItems=t.filter(n=>this.selectedColumns.includes(n.id)),this.columnSelector.updateSelectedUI()}}_fetchData(){this.isLoading||(this.isLoading=!0,this.currentQuery instanceof g||(this.currentQuery=new g(this.controller,this.currentQuery)),w(this.controller,this.apiPrefix).then(e=>{if(this.entityProperties=e,this.select2Columns)if(!this.columnSelector)this._createColumnSelector();else{let t=this.entityProperties.map(s=>({id:s.name,name:s.name}));this.columnSelector.cfg.localData=t,(!this.selectedColumns||this.selectedColumns.length===0)&&(this.selectedColumns=t.slice(0,8).map(s=>s.id),this.columnSelector.selectedItems=t.filter(s=>this.selectedColumns.includes(s.id))),this.columnSelector.updateSelectedUI()}}).catch(e=>{console.error("fetchProperties error:",e)}),I(`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}/${E.filterPagedRoute}`,this.currentQuery).then(e=>{this.data=e.items,this.totalCount=e.totalCount,(this.currentQuery.select&&this.currentQuery.select.trim()!==""||this.currentQuery.groupBy&&this.currentQuery.groupBy.trim()!=="")&&this.queryBuilder._updateUI(),this._renderTable(),this._renderPager()}).catch(e=>{console.error("Data fetch error:",e),this.tableElm.innerHTML="<tr><td colspan='100%'>Data not found.</td></tr>"}).finally(()=>{this.isLoading=!1}))}_updateQuery(e){let t={...this.currentQuery,...e};this.currentQuery=new g(this.controller,t),this.stateManager.setState({query:this.currentQuery})}_renderTable(){if(this.tableElm.innerHTML="",!this.data||this.data.length===0){let n=this.tableElm.insertRow().insertCell();n.colSpan=100,n.textContent="No records found";return}let e=[];if(this.currentQuery.select&&this.currentQuery.select.trim()!==""||this.currentQuery.groupBy&&this.currentQuery.groupBy.trim()!==""?e=Object.keys(this.data[0]).map(n=>({name:n,kind:"simple"})):(e=(this.entityProperties||[]).filter(i=>i.type.toLowerCase()!=="displayproperty"),this.select2Columns&&this.selectedColumns&&this.selectedColumns.length>0&&(e=e.filter(i=>this.selectedColumns.includes(i.name)))),e.sort((i,n)=>i.name.toLowerCase()==="id"?-1:n.name.toLowerCase()==="id"?1:0),e.length===0){this.tableElm.innerHTML="<tr><td colspan='100%'>No columns selected.</td></tr>";return}let s=this.tableElm.createTHead().insertRow();e.forEach(i=>{let n=document.createElement("th");n.textContent=i.name,i.kind==="simple"?(n.style.cursor="pointer",n.addEventListener("click",()=>this._onHeaderClick(i.name)),this.currentQuery.orderBy===i.name&&this.currentQuery.orderBy&&(n.textContent+=this.currentQuery.desc?" \u25B2":" \u25BC")):(n.style.cursor="default",n.style.pointerEvents="none"),s.appendChild(n)});let r=document.createElement("th");r.textContent="Actions",s.appendChild(r);let a=this.tableElm.createTBody();this.data.forEach((i,n)=>{let c=a.insertRow();c.setAttribute("data-index",n);for(let o of e){let u=c.insertCell(),m=i[o.name];if(o.kind==="simple")u.textContent=m??"";else if(m){let y=document.createElement("button");y.textContent="+",y.className="btn btn-sm btn-secondary",y.addEventListener("click",()=>{alert(`Details for ${o.name}: ${JSON.stringify(m)}`)}),u.appendChild(y)}else u.textContent=""}let l=c.insertCell(),d=document.createElement("button");d.textContent="Edit",d.className="btn btn-sm btn-primary me-1",d.addEventListener("click",()=>this._openInlineEdit(n)),l.appendChild(d);let h=document.createElement("button");h.textContent="Nested",h.className="btn btn-sm btn-info",l.appendChild(h)})}_renderPager(){this.pagerElm.innerHTML="";let e=this.currentQuery.pager.pageSize,t=this.totalCount?Math.ceil(this.totalCount/e):1,s=this.currentQuery.pager.pageNumber,r=document.createElement("div");r.className="d-flex align-items-center";let a=document.createElement("button");a.innerHTML="&lt;",a.className="btn btn-secondary me-2",a.disabled=s<=1,a.addEventListener("click",()=>{s>1&&(this._updateQuery({pager:new f(s-1,e)}),this._fetchData())}),r.appendChild(a);let i=o=>{let u=document.createElement("button");return u.textContent=o,u.className="btn btn-light mx-1",o===s&&u.classList.add("active"),u.addEventListener("click",()=>{o!==s&&(this._updateQuery({pager:new f(o,e)}),this._fetchData())}),u};r.appendChild(i(1));let n=Math.max(2,s),c=Math.min(t-1,s+2);if(n>2){let o=document.createElement("span");o.textContent="...",o.className="mx-1",r.appendChild(o)}for(let o=n;o<=c;o++)r.appendChild(i(o));if(c<t-1){let o=document.createElement("span");o.textContent="...",o.className="mx-1",r.appendChild(o)}t>1&&r.appendChild(i(t));let l=document.createElement("button");l.innerHTML="&gt;",l.className="btn btn-secondary ms-2",l.disabled=s>=t,l.addEventListener("click",()=>{s<t&&(this._updateQuery({pager:new f(s+1,e)}),this._fetchData())}),r.appendChild(l);let d=document.createElement("select");d.className="form-select ms-3",[10,25,50,100,250,500].forEach(o=>{let u=document.createElement("option");u.value=o,u.textContent=o,o===e&&(u.selected=!0),d.appendChild(u)}),d.addEventListener("change",()=>{let o=parseInt(d.value,10);this._updateQuery({pager:new f(1,o)}),this._fetchData()}),r.appendChild(d),this.pagerElm.appendChild(r)}_onHeaderClick(e){this.currentQuery&&this.currentQuery.orderBy===e?this._updateQuery({desc:!this.currentQuery.desc}):this._updateQuery({orderBy:e,desc:!1}),this.currentPage=1,this._fetchData()}_openInlineEdit(e){this.editingIndex!==null&&this.editingIndex!==e&&this._cancelInlineEdit(this.editingIndex),this.editingIndex=e;let t=this.tableElm.querySelector(`tr[data-index='${e}']`);if(!t)return;let s=this.data[e],r=t.cells,a=r.length-1,i=Object.keys(s);for(let d=0;d<a;d++){let h=i[d];if(h==="id")continue;let o=r[d],u=s[h]==null?"":s[h];o.innerHTML="";let m="text",y=typeof s[h];y==="number"&&(m="number"),y==="boolean"&&(m="checkbox"),y==="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(u)&&(m="date");let C=document.createElement("input");C.name=h,C.type=m,C.className="form-control",m==="checkbox"?C.checked=!!u:m==="date"?C.value=u?String(u).substring(0,10):"":C.value=u,o.appendChild(C)}let n=r[r.length-1];n.innerHTML="";let c=document.createElement("button");c.textContent="Kaydet",c.className="btn btn-sm btn-success me-1",c.addEventListener("click",()=>this._saveInlineEdit(e));let l=document.createElement("button");l.textContent="\u0130ptal",l.className="btn btn-sm btn-secondary",l.addEventListener("click",()=>this._cancelInlineEdit(e)),n.appendChild(c),n.appendChild(l)}_saveInlineEdit(e){let t=this.tableElm.querySelector(`tr[data-index='${e}']`);if(!t)return;let s=this.data[e],r=t.querySelectorAll("input"),a={...s};r.forEach(l=>{let d=l.name,h=this.entityProperties.find(u=>u.name.toLowerCase()===d.toLowerCase()),o;l.type==="checkbox"?o=l.checked:l.type==="number"?o=l.value===""?null:Number(l.value):(l.type,o=l.value),!(h&&(h.kind==="complex"||h.kind==="complexList")&&(o===""||o===null))&&(a[d]=o)});let i=Object.keys(s).find(l=>l.toLowerCase()==="id")||"id",n=s[i],c=`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}/${n}`;fetch(c,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(l=>{if(!l.ok)throw new Error(`Update error: ${l.status}`);return l.json()}).then(l=>{this.data[e]=l,this.editingIndex=null,this._renderUpdatedRow(e)}).catch(l=>{console.error("Record update error:",l)})}_cancelInlineEdit(e){this.editingIndex===e&&(this.editingIndex=null),this._renderUpdatedRow(e)}_renderUpdatedRow(e){let t=this.tableElm.querySelector(`tr[data-index='${e}']`);if(!t)return;let s=this.data[e],r=t.cells,a=r.length-1,i=Object.keys(s);for(let d=0;d<a;d++){let h=i[d],o=r[d];o.innerHTML="",o.textContent=s[h]==null?"":s[h]}let n=r[r.length-1];n.innerHTML="";let c=document.createElement("button");c.textContent="D\xFCzenle",c.className="linq-edit-btn",c.addEventListener("click",()=>this._openInlineEdit(e)),n.appendChild(c);let l=document.createElement("button");l.textContent="Alt",l.className="linq-nest-btn",l.addEventListener("click",()=>this.openNestedGrid(e)),n.appendChild(l)}_openCreateForm(){this.entityProperties?this._showCreateForm():w(this.controller,this.apiPrefix).then(e=>{this.entityProperties=e,this._showCreateForm()}).catch(e=>{console.error("\xD6zellik listesi al\u0131namad\u0131, form olu\u015Fturulam\u0131yor.",e)})}_showCreateForm(){v.createForm(this.containerElm,this.entityProperties,{},{mode:"Create",onSave:e=>{let t=`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}`;fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(s=>{if(!s.ok)throw new Error(`Kay\u0131t olu\u015Fturulamad\u0131: ${s.status}`);return s.json()}).then(s=>{this._fetchData()}).catch(s=>console.error("Yeni kay\u0131t olu\u015Fturma hatas\u0131:",s))}})}_openUpdateForm(e){let t=this.data[e];v.createForm(this.containerElm,this.entityProperties,t,{mode:"Update",onSave:s=>{let r=Object.keys(t).find(n=>"id")||"id",a=t[r],i=`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}/${a}`;fetch(i,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(n=>{if(!n.ok)throw new Error(`G\xFCncelleme hatas\u0131: ${n.status}`);return n.json()}).then(n=>{this.data[e]=n,this._fetchData()}).catch(n=>console.error("Kay\u0131t g\xFCncelleme hatas\u0131:",n))}})}};export{k as ComparisonFilter,x as Filter,v as FormManager,B as Include,T as LinqDataTable,L as LinqSelect2,b as LogicalFilter,f as Pager,g as Query,S as QueryBuilder,P as StateManager,N as ThenInclude,_ as analyzePropertyType,H as buildFilter,q as debounce,E as defaults,I as fetchPagedData,w as fetchProperties};
