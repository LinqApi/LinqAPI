class e{constructor(e="",{filter:t=new r("AND"),pager:s=new n,orderBy:i="id",desc:a=!0,groupBy:o="",select:l="",includes:c=[]}={}){this.controller=e,this.filter=t,this.pager=s,this.orderBy=i,this.desc=a,this.groupBy=o,this.select=l,this.includes=c}toPayload(){return{filter:this.filter.toString(),pager:this.pager,orderBy:this.orderBy,desc:this.desc,groupBy:this.groupBy,select:this.select,includes:this.includes.map((e=>e.toPayload()))}}}class t{constructor(e,t=new n,s=[]){this.propertyName=e,this.pager=t,this.thenIncludes=s}toPayload(){return{propertyName:this.propertyName,pager:this.pager,thenIncludes:this.thenIncludes.map((e=>e.toPayload()))}}}class s{constructor(e,t=[],s=new n){this.parentProperty=e,this.childIncludes=t,this.pager=s}toPayload(){return{parentProperty:this.parentProperty,childIncludes:this.childIncludes,pager:this.pager}}}class n{constructor(e=1,t=10){this.pageNumber=e,this.pageSize=t}}class i{toString(){return""}}class r extends i{constructor(e="AND",t=[]){super(),this.operator=e,this.filters=t}toString(){if(!this.filters.length)return"1=1";const e=this.filters.map((e=>e.toString())).join(` ${this.operator} `);return this.filters.length>1?`(${e})`:e}}class a extends i{constructor(e,t,s){super(),this.field=e,this.operator=t,this.value=s}toString(){return`${this.field} ${this.operator} ${this.value}`}}class o{static createForm(e,t,s={},n={mode:"Create"}){const i=document.createElement("div");i.className="card card-body mb-3";const r={},a=["string","int64","boolean","datetime","int32"];t.forEach((e=>{if(e.type.includes("ICollection")||"id"===e.name)return;const t=e.type.toLowerCase();if(!a.some((e=>t.includes(e))))return;const n=document.createElement("label");n.textContent=e.name;const o=document.createElement("input");o.type="text",o.className="form-control mb-2",o.value=s[e.name]||"",i.appendChild(n),i.appendChild(o),r[e.name]=o}));const o=document.createElement("div");o.className="d-flex justify-content-end gap-2";const l=document.createElement("button");l.className="btn btn-success me-2",l.innerHTML='<i class="bi bi-check-circle"></i>',l.addEventListener("click",(()=>{const e={};for(const t in r)e[t]=r[t].value;"function"==typeof n.onSave&&n.onSave(e),i.classList.remove("show"),i.classList.add("collapse")}));const c=document.createElement("button");return c.className="btn btn-danger",c.innerHTML='<i class="bi bi-x-circle"></i>',c.addEventListener("click",(()=>{i.classList.remove("show"),i.classList.add("collapse")})),o.appendChild(l),o.appendChild(c),i.appendChild(o),e.insertBefore(i,e.firstChild),i}}const l=(e,t=300)=>{let s;return(...n)=>{clearTimeout(s),s=setTimeout((()=>e(...n)),t)}},c={apiPrefix:"/api",propertiesRoute:"properties",filterPagedRoute:"filterpaged",defaultPageSize:10,debounceDuration:300},d=({searchProperty:e,query:t,filterSuffix:s=""})=>{const n=t?`${e}.Contains("${t}")`:"";return s?n?`${s} AND ${n}`:s:n||"1=1"},h=async(e,t)=>{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.toPayload())}),n=await s.json();return{items:n.items||n.$values||[],totalCount:n.totalRecords||0}},u=e=>{const t=e.match(/^(ICollection|IList|IReadOnlyCollection)<\s*(.+)\s*>$/i);if(t)return{kind:"complexList",baseType:t[2].trim()};const s=e.toLowerCase();return["string","int64","boolean","datetime","int32"].some((e=>s.includes(e)))?{kind:"simple",baseType:e}:{kind:"complex",baseType:e}},p=async(e,t="/api")=>{const s=`${t.replace(/\/+$/,"")}/${e}/properties`;return fetch(s).then((e=>{if(!e.ok)throw new Error(`fetchProperties request failed: ${e.status}`);return e.json()})).then((e=>e.map((e=>{const t=u(e.type);return{...e,kind:t.kind,baseType:t.baseType,displayProperties:e.displayProperties||[]}})).filter((e=>"string"==typeof e.type&&"displayproperty"!==e.type.toLowerCase())))).catch((e=>{throw console.error("fetchProperties error:",e),e}))};class m{constructor(e={}){this.state=e,this.listeners=new Map}getState(){return this.state}setState(e){this.state={...this.state,...e},this.notify()}subscribe(e,t){if("function"!=typeof t)throw new Error("Listener must be a function");return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.listeners.get(e).delete(t)}}notify(){for(const[e,t]of this.listeners.entries()){const s=this.state[e];t.forEach((e=>e(s)))}}}class y{constructor({container:t,stateManager:s,controller:i,apiPrefix:a="/api",properties:o=null}){if(this.stateManager=s,this.controller=i,this.apiPrefix=a,this.containerElm="string"==typeof t?document.querySelector(t):t,!this.containerElm)throw new Error("QueryBuilder: Invalid container.");this.query=this.stateManager.getState("query")||new e(i,{filter:new r("AND",[{toString:()=>"1=1"}]),pager:new n,orderBy:"id",desc:!0,groupBy:"",select:"",includes:[]}),this.properties=o,this.properties||p(this.controller,this.apiPrefix).then((e=>{this.properties=e})).catch((e=>console.error("Failed to fetch properties:",e))),this._render(),this.stateManager.subscribe("query",(e=>{this.query=e,this._updateUI()}))}_render(){this.containerElm.innerHTML="";const e=document.createElement("div");e.className="row mb-3";const t=document.createElement("div");t.className="col-md-6";const s=document.createElement("label");s.textContent="Filter:",s.className="form-label",this.filterInput=document.createElement("input"),this.filterInput.type="text",this.filterInput.className="form-control",this.filterInput.value=this.query&&this.query.filter&&this.query.filter.toString()||"1=1",t.appendChild(s),t.appendChild(this.filterInput),e.appendChild(t);const n=document.createElement("div");n.className="col-md-6";const i=document.createElement("label");i.textContent="Select:",i.className="form-label",this.selectInput=document.createElement("input"),this.selectInput.type="text",this.selectInput.className="form-control",this.selectInput.value=this.query&&this.query.select||"",n.appendChild(i),n.appendChild(this.selectInput),e.appendChild(n),this.containerElm.appendChild(e);const r=document.createElement("div");r.className="row mb-3";const a=document.createElement("div");a.className="col-md-6";const o=document.createElement("label");o.textContent="GroupBy:",o.className="form-label",this.groupByInput=document.createElement("input"),this.groupByInput.type="text",this.groupByInput.className="form-control",this.groupByInput.value=this.query&&this.query.groupBy||"",a.appendChild(o),a.appendChild(this.groupByInput),r.appendChild(a);const l=document.createElement("div");l.className="col-md-6";const c=document.createElement("label");c.textContent="OrderBy:",c.className="form-label",this.orderByInput=document.createElement("input"),this.orderByInput.type="text",this.orderByInput.className="form-control",this.orderByInput.value=this.query&&this.query.orderBy||"id",l.appendChild(c),l.appendChild(this.orderByInput),r.appendChild(l),this.containerElm.appendChild(r);const d=document.createElement("div");d.className="row mb-3 align-items-center";const h=document.createElement("div");h.className="col-md-6";const u=document.createElement("div");u.className="form-check",this.descInput=document.createElement("input"),this.descInput.type="checkbox",this.descInput.className="form-check-input",this.descInput.checked=!this.query||"boolean"!=typeof this.query.desc||this.query.desc;const p=document.createElement("label");p.textContent="Desc:",p.className="form-check-label",u.appendChild(this.descInput),u.appendChild(p),h.appendChild(u),d.appendChild(h);const m=document.createElement("div");m.className="col-md-6 text-end",this.applyBtn=document.createElement("button"),this.applyBtn.textContent="Uygula",this.applyBtn.className="btn btn-primary",this.applyBtn.addEventListener("click",(()=>this._applyQuery())),m.appendChild(this.applyBtn),d.appendChild(m),this.containerElm.appendChild(d)}_applyQuery(){const t={filter:new r("AND",[{toString:()=>this.filterInput.value?this.filterInput.value:"1=1"}]),select:this.selectInput.value||"",groupBy:this.groupByInput.value||"",orderBy:this.orderByInput.value||"id",desc:!!this.descInput.checked};this.stateManager.setState({query:new e(this.controller,t)})}_updateUI(){this.filterInput.value=this.query&&this.query.filter&&this.query.filter.toString()||"1=1",this.selectInput.value=this.query&&this.query.select||"",this.groupByInput.value=this.query&&this.query.groupBy||"",this.orderByInput.value=this.query&&this.query.orderBy||"id",this.descInput.checked=!this.query||"boolean"!=typeof this.query.desc||this.query.desc}onQueryUpdated(e){this.query=e,this.query.select=this.selectInput.value,this.query.groupBy=this.groupByInput.value,this.query.orderBy=this.orderByInput.value,this.query.desc=this.descInput.checked,this.query.pager=e.Pager}}class f{constructor(e){this.cfg={container:null,controller:"",apiPrefix:c.apiPrefix,searchProperty:"name",displayProperty:"name",valueField:"id",filterSuffix:"",renderMode:"tag",fetchMode:"server",selectPlaceHolder:"Select...",localData:[],multiselect:!1,pageSize:c.defaultPageSize,debounceDuration:c.debounceDuration,disabled:!1,...e},this.selectedItems=[],this.init()}init(){this.container=this.cfg.container,this.container.style.position="relative",window.addEventListener("resize",(()=>{this.dropdown.style.top="100%"})),this.container.innerHTML=`\n        <div class="select2-wrapper" style="position: relative;">\n            <input class="form-control mb-1" placeholder="${this.cfg.placeholder||"Select..."}" />\n            <div class="dropdown-menu w-100"></div>\n        </div>\n        <div class="selected-items mt-2"></div>\n    `;const e=this.container.querySelector(".select2-wrapper");[this.input,this.dropdown]=e.children,this.selectedContainer=this.container.querySelector(".selected-items"),Object.assign(this.dropdown.style,{position:"absolute",top:"100%",left:"0",zIndex:"1000"}),this.cfg.disabled?(this.input.disabled=!0,this.dropdown.classList.remove("show")):(this.input.oninput=l((()=>this.fetchData(this.input.value)),this.cfg.debounceDuration),this.input.onfocus=()=>this.fetchData(""),document.addEventListener("click",(e=>{this.container.contains(e.target)||this.dropdown.classList.remove("show")})))}async fetchData(t){if("server"===this.cfg.fetchMode){const s=`${this.cfg.apiPrefix}/${this.cfg.controller}/${c.filterPagedRoute}`,i=[];t&&i.push(`${this.cfg.searchProperty}.Contains("${t}")`),this.cfg.filterSuffix&&i.push(this.cfg.filterSuffix);const a=new r("AND",i),o=new e(this.cfg.controller,{filter:a,pager:new n(1,this.cfg.pageSize),orderBy:this.cfg.valueField,desc:!1});this.data=await h(s,o)}else{const e=t.toLowerCase();this.data={items:this.cfg.localData.filter((t=>t[this.cfg.searchProperty].toLowerCase().includes(e)))}}this.renderDropdown()}renderDropdown(){if("checkbox"===this.cfg.renderMode){let e='<table class="table table-sm mb-0"><tbody>';this.data.items.forEach(((t,s)=>{const n=this.getDisplayText(t),i=this.selectedItems.some((e=>e[this.cfg.valueField]===t[this.cfg.valueField]));e+=`\n                <tr>\n                    <td style="width: 1%;">\n                        <input type="checkbox" data-index="${s}" ${i?"checked":""} />\n                    </td>\n                    <td>${n}</td>\n                </tr>\n            `})),e+="</tbody></table>",this.dropdown.innerHTML=e;this.dropdown.querySelectorAll("input[type='checkbox']").forEach((e=>{e.addEventListener("change",(e=>{const t=e.target.getAttribute("data-index"),s=this.data.items[t];e.target.checked?this.selectedItems.some((e=>e[this.cfg.valueField]===s[this.cfg.valueField]))||this.selectedItems.push(s):this.selectedItems=this.selectedItems.filter((e=>e[this.cfg.valueField]!==s[this.cfg.valueField])),"function"==typeof this.cfg.onChange&&this.cfg.onChange(this.getValue())}))})),this.dropdown.classList.add("show")}else this.dropdown.innerHTML=this.data.items.map((e=>`<a class="dropdown-item">${this.getDisplayText(e)}</a>`)).join(""),Array.from(this.dropdown.children).forEach(((e,t)=>{e.onclick=()=>this.selectItem(this.data.items[t])})),this.dropdown.classList.add("show")}selectItem(e){this.cfg.disabled||(this.cfg.multiselect?this.selectedItems.some((t=>t[this.cfg.valueField]===e[this.cfg.valueField]))||this.selectedItems.push(e):this.selectedItems=[e],this.updateSelectedUI(),this.cfg.multiselect||this.dropdown.classList.remove("show"))}updateSelectedUI(){const e=e=>this.getDisplayText(e);this.cfg.multiselect?(this.input.value="","tag"===this.cfg.renderMode?(this.selectedContainer.innerHTML=this.selectedItems.map((t=>`\n                <span class="badge bg-secondary me-1">\n                    ${e(t)}\n                    <span data-id="${t[this.cfg.valueField]}" class="ms-1" style="cursor: pointer;">&times;</span>\n                </span>\n            `)).join(""),this.selectedContainer.querySelectorAll("[data-id]").forEach((e=>{e.onclick=()=>{this.removeSelected(e.dataset.id),"function"==typeof this.cfg.onChange&&this.cfg.onChange(this.getValue())}}))):"grid"===this.cfg.renderMode&&(this.selectedContainer.innerHTML=`\n                <table class="table table-bordered small">\n                    <tbody>\n                        ${this.selectedItems.map((t=>`\n                            <tr>\n                                <td>${e(t)}</td>\n                                <td style="width:1%; white-space: nowrap;">\n                                    <button class="btn btn-sm btn-danger" data-id="${t[this.cfg.valueField]}">&times;</button>\n                                </td>\n                            </tr>\n                        `)).join("")}\n                    </tbody>\n                </table>\n            `,this.selectedContainer.querySelectorAll("button[data-id]").forEach((e=>{e.onclick=()=>{this.removeSelected(e.getAttribute("data-id")),"function"==typeof this.cfg.onChange&&this.cfg.onChange(this.getValue())}})))):(this.input.value=this.selectedItems[0]?e(this.selectedItems[0]):"",this.selectedContainer.innerHTML=""),"function"==typeof this.cfg.onChange&&this.cfg.onChange(this.getValue())}removeSelected(e){this.selectedItems=this.selectedItems.filter((t=>t[this.cfg.valueField].toString()!==e.toString())),this.updateSelectedUI()}getValue(){return this.cfg.multiselect?this.selectedItems:this.selectedItems[0]||null}getDisplayText(e){return Array.isArray(this.cfg.displayProperty)?this.cfg.displayProperty.map((t=>e[t])).filter((e=>null!=e)).join(" - "):e[this.cfg.displayProperty]??""}}class g{constructor({container:t,controller:s,apiPrefix:i="/api",stateManager:a=null,queryBuilderContainer:o=null,autoCreateQueryBuilder:l=!0,customActions:c=[],select2Columns:d=!1}){if(this.containerElm="string"==typeof t?document.querySelector(t):t,!this.containerElm)throw new Error("LinqDataTable: Invalid container element.");this.controller=s,this.apiPrefix=i,this.stateManager=a||new m,this.customActions=c,this.data=[],this.totalCount=0,this.pageSize=10,this.currentSort=null,this.isLoading=!1,this.entityProperties=null,this.editingIndex=null,this.select2Columns=d,this.selectedColumns=[],this._renderTopControls(),this.tableElm=document.createElement("table"),this.tableElm.className="table table-striped table-hover",this.containerElm.appendChild(this.tableElm),this.pagerElm=document.createElement("div"),this.pagerElm.className="d-flex justify-content-between align-items-center mt-3",this.containerElm.appendChild(this.pagerElm),l&&(this.queryBuilder=new y({container:o,stateManager:this.stateManager,controller:this.controller,apiPrefix:this.apiPrefix}),this.queryBuilder.onQueryUpdated((e=>{this.currentQuery=e,this.currentPage=1,this._fetchData()})),this.stateManager.subscribe("query",(e=>{this.currentQuery=e,this.currentPage=1,this._fetchData()}))),this.currentQuery=this.stateManager.getState("query")||this.queryBuilder.query,this.currentQuery instanceof e||(this.currentQuery=new e(this.controller,{filter:this.currentQuery.filter||new r("AND",[{toString:()=>"1=1"}]),pager:this.currentQuery.pager||new n,orderBy:this.currentQuery.orderBy||"id",desc:"boolean"!=typeof this.currentQuery.desc||this.currentQuery.desc,groupBy:this.currentQuery.groupBy||"",select:this.currentQuery.select||"",includes:this.currentQuery.includes||[]})),this._fetchData()}_renderTopControls(){const e=document.createElement("div");e.className="mb-3";const t=document.createElement("button");t.type="button",t.textContent="Yeni Ekle",t.className="btn btn-primary",t.addEventListener("click",(()=>this._openCreateForm())),e.appendChild(t),this.select2Columns&&(this.columnSelectContainer=document.createElement("div"),this.columnSelectContainer.className="mb-2",e.appendChild(this.columnSelectContainer)),this.containerElm.appendChild(e)}_createColumnSelector(){const e=this.entityProperties.filter((e=>"displayproperty"!==e.type.toLowerCase()&&"complex"!==e.kind.toLowerCase()&&"complexlist"!==e.kind.toLowerCase())).map((e=>({id:e.name,name:e.name})));if(this.columnSelector=new f({container:this.columnSelectContainer,controller:"",multiselect:!0,renderMode:"checkbox",fetchMode:"client",localData:e,displayProperty:"name",valueField:"id",selectPlaceHolder:"Select columns...",onChange:e=>{this.selectedColumns=e.map((e=>e.id)),this._renderTable()}}),e.length>0){const t=e.find((e=>"id"===e.id.toLowerCase())),s=8-(t?1:0),n=e.filter((e=>"id"!==e.id.toLowerCase())).slice(0,s);this.selectedColumns=[],t&&this.selectedColumns.push(t.id),n.forEach((e=>this.selectedColumns.push(e.id))),this.columnSelector.selectedItems=e.filter((e=>this.selectedColumns.includes(e.id))),this.columnSelector.updateSelectedUI()}}_fetchData(){this.isLoading||(this.isLoading=!0,this.currentQuery instanceof e||(this.currentQuery=new e(this.controller,this.currentQuery)),p(this.controller,this.apiPrefix).then((e=>{if(this.entityProperties=e,this.select2Columns)if(this.columnSelector){const e=this.entityProperties.map((e=>({id:e.name,name:e.name})));this.columnSelector.cfg.localData=e,this.selectedColumns&&0!==this.selectedColumns.length||(this.selectedColumns=e.slice(0,8).map((e=>e.id)),this.columnSelector.selectedItems=e.filter((e=>this.selectedColumns.includes(e.id)))),this.columnSelector.updateSelectedUI()}else this._createColumnSelector()})).catch((e=>{console.error("fetchProperties error:",e)})),h(`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}/${c.filterPagedRoute}`,this.currentQuery).then((e=>{this.data=e.items,this.totalCount=e.totalCount,(this.currentQuery.select&&""!==this.currentQuery.select.trim()||this.currentQuery.groupBy&&""!==this.currentQuery.groupBy.trim())&&this.queryBuilder._updateUI(),this._renderTable(),this._renderPager()})).catch((e=>{console.error("Data fetch error:",e),this.tableElm.innerHTML="<tr><td colspan='100%'>Data not found.</td></tr>"})).finally((()=>{this.isLoading=!1})))}_updateQuery(t){const s={...this.currentQuery,...t};this.currentQuery=new e(this.controller,s),this.stateManager.setState({query:this.currentQuery})}_renderTable(){if(this.tableElm.innerHTML="",!this.data||0===this.data.length){const e=this.tableElm.insertRow().insertCell();return e.colSpan=100,void(e.textContent="No records found")}const e=this.getVisibleProperties();if(0===e.length)return void(this.tableElm.innerHTML="<tr><td colspan='100%'>No columns selected.</td></tr>");const t=this.tableElm.createTHead().insertRow();e.forEach((e=>{const s=document.createElement("th");s.textContent=e.name,"simple"===e.kind?(s.style.cursor="pointer",s.addEventListener("click",(()=>this._onHeaderClick(e.name))),this.currentQuery.orderBy===e.name&&this.currentQuery.orderBy&&(s.textContent+=this.currentQuery.desc?" ▲":" ▼")):(s.style.cursor="default",s.style.pointerEvents="none"),t.appendChild(s)}));const s=document.createElement("th");s.textContent="Actions",t.appendChild(s);const n=this.tableElm.createTBody();this.data.forEach(((t,s)=>{const i=n.insertRow();i.setAttribute("data-index",s);for(const s of e){const e=i.insertCell(),n=t[s.name];if("simple"===s.kind)e.textContent=null==n?"":n;else if(n){const t=document.createElement("button");t.textContent="+",t.className="btn btn-sm btn-secondary",t.addEventListener("click",(()=>{alert(`Details for ${s.name}: ${JSON.stringify(n)}`)})),e.appendChild(t)}else e.textContent=""}const r=i.insertCell();this.renderActionCell(r,t,s)}))}_renderPager(){this.pagerElm.innerHTML="";const e=this.currentQuery.pager.pageSize,t=this.totalCount?Math.ceil(this.totalCount/e):1,s=this.currentQuery.pager.pageNumber,i=document.createElement("div");i.className="d-flex align-items-center";const r=document.createElement("button");r.innerHTML="&lt;",r.className="btn btn-secondary me-2",r.disabled=s<=1,r.addEventListener("click",(()=>{s>1&&(this._updateQuery({pager:new n(s-1,e)}),this._fetchData())})),i.appendChild(r);const a=t=>{const i=document.createElement("button");return i.textContent=t,i.className="btn btn-light mx-1",t===s&&i.classList.add("active"),i.addEventListener("click",(()=>{t!==s&&(this._updateQuery({pager:new n(t,e)}),this._fetchData())})),i};i.appendChild(a(1));let o=Math.max(2,s),l=Math.min(t-1,s+2);if(o>2){const e=document.createElement("span");e.textContent="...",e.className="mx-1",i.appendChild(e)}for(let e=o;e<=l;e++)i.appendChild(a(e));if(l<t-1){const e=document.createElement("span");e.textContent="...",e.className="mx-1",i.appendChild(e)}t>1&&i.appendChild(a(t));const c=document.createElement("button");c.innerHTML="&gt;",c.className="btn btn-secondary ms-2",c.disabled=s>=t,c.addEventListener("click",(()=>{s<t&&(this._updateQuery({pager:new n(s+1,e)}),this._fetchData())})),i.appendChild(c);const d=document.createElement("select");d.className="form-select ms-3";[10,25,50,100,250,500].forEach((t=>{const s=document.createElement("option");s.value=t,s.textContent=t,t===e&&(s.selected=!0),d.appendChild(s)})),d.addEventListener("change",(()=>{const e=parseInt(d.value,10);this._updateQuery({pager:new n(1,e)}),this._fetchData()})),i.appendChild(d),this.pagerElm.appendChild(i)}_onHeaderClick(e){this.currentQuery&&this.currentQuery.orderBy===e?this._updateQuery({desc:!this.currentQuery.desc}):this._updateQuery({orderBy:e,desc:!1}),this.currentPage=1,this._fetchData()}_openInlineEdit(e){const t=this.getVisibleProperties(),s=this.tableElm.querySelector(`tr[data-index='${e}']`);if(!s)return;const n=this.data[e],i=s.cells;t.forEach(((e,t)=>{if("id"===e.name.toLowerCase())return;const s=i[t],r=null==n[e.name]?"":n[e.name];s.innerHTML="";let a="text";"number"==typeof n[e.name]?a="number":"boolean"==typeof n[e.name]?a="checkbox":"string"==typeof n[e.name]&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(r)&&(a="date");const o=document.createElement("input");o.name=e.name,o.type=a,o.className="form-control","checkbox"===a?o.checked=Boolean(r):o.value="date"===a?r?String(r).substring(0,10):"":r,s.appendChild(o)}));const r=i[i.length-1];r.innerHTML="",this.renderInlineActionCell(r,n,e),this.editingIndex=e}_saveInlineEdit(e){const t=this.tableElm.querySelector(`tr[data-index='${e}']`);if(!t)return;const s=this.data[e],n=t.querySelectorAll("input"),i={...s};n.forEach((e=>{const t=e.name,s=this.entityProperties.find((e=>e.name.toLowerCase()===t.toLowerCase()));let n;n="checkbox"===e.type?e.checked:"number"===e.type?""===e.value?null:Number(e.value):(e.type,e.value),(!s||"complex"!==s.kind&&"complexList"!==s.kind||""!==n&&null!==n)&&(null==n||"string"==typeof n&&""===n.trim()||(i[t]=n))}));const r=s[Object.keys(s).find((e=>"id"===e.toLowerCase()))||"id"],a=`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}/${r}`;fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>{if(!e.ok)throw new Error(`Update error: ${e.status}`);return e.json()})).then((t=>{this.data[e]=t,this.editingIndex=null,this._renderTable()})).catch((e=>{console.error("Record update error:",e)}))}_cancelInlineEdit(e){this.editingIndex===e&&(this.editingIndex=null),this._renderTable()}getVisibleProperties(){let e=[];if(this.currentQuery.select&&""!==this.currentQuery.select.trim()||this.currentQuery.groupBy&&""!==this.currentQuery.groupBy.trim()){e=Object.keys(this.data[0]||{}).map((e=>({name:e,kind:"simple"})))}else e=(this.entityProperties||[]).filter((e=>"displayproperty"!==e.type.toLowerCase()&&"complex"!==e.kind.toLowerCase()&&"complexlist"!==e.kind.toLowerCase())),this.select2Columns&&this.selectedColumns&&this.selectedColumns.length>0&&(e=e.filter((e=>this.selectedColumns.includes(e.name))));return e.sort(((e,t)=>"id"===e.name.toLowerCase()?-1:"id"===t.name.toLowerCase()?1:0)),e}renderActionCell(e,t,s){e.innerHTML="";const n=document.createElement("button");n.textContent="Edit",n.className="btn btn-sm btn-primary me-1",n.addEventListener("click",(()=>this._openInlineEdit(s))),e.appendChild(n),this.customActions.forEach((n=>{const i=document.createElement("button");i.textContent=n.label,i.className=n.className||"btn btn-sm btn-warning ms-1",i.addEventListener("click",(()=>{n.onClick(t,s)})),e.appendChild(i)}))}renderInlineActionCell(e,t,s){e.innerHTML="";const n=document.createElement("button");n.textContent="Save",n.className="btn btn-sm btn-success me-1",n.addEventListener("click",(()=>this._saveInlineEdit(s))),e.appendChild(n);const i=document.createElement("button");i.textContent="Cancel",i.className="btn btn-sm btn-secondary",i.addEventListener("click",(()=>this._cancelInlineEdit(s))),e.appendChild(i)}_openCreateForm(){this.entityProperties?this._showCreateForm():p(this.controller,this.apiPrefix).then((e=>{this.entityProperties=e,this._showCreateForm()})).catch((e=>{console.error("Prop List could not got error, Can not create the form",e)}))}_showCreateForm(){let e=this.containerElm.querySelector(".form-container");e?e.innerHTML="":(e=document.createElement("div"),e.className="form-container mb-3",this.containerElm.insertBefore(e,this.tableElm)),o.createForm(e,this.entityProperties,{},{mode:"Create",onSave:e=>{const t={};for(const s in e){const n=e[s];null==n||"string"==typeof n&&""===n.trim()||(t[s]=n)}const s=`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}`;fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{if(!e.ok)throw new Error(`Kayıt oluşturulamadı: ${e.status}`);return e.json()})).then((e=>{this._fetchData()})).catch((e=>console.error("Yeni kayıt oluşturma hatası:",e)))}})}_openUpdateForm(e){const t=this.entityProperties.filter((e=>"complex"!==e.kind.toLowerCase()&&"complexlist"!==e.kind.toLowerCase())),s=this.data[e];o.createForm(this.containerElm,t,s,{mode:"Update",onSave:t=>{const n={};for(const e in t){const s=t[e];null==s||"string"==typeof s&&""===s.trim()||(n[e]=s)}const i=Object.keys(s).find((e=>"id"===e.toLowerCase()))||"id",r=s[i],a=`${this.apiPrefix.replace(/\/+$/,"")}/${this.controller}/${r}`;fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(!e.ok)throw new Error(`Güncelleme hatası: ${e.status}`);return e.json()})).then((t=>{this.data[e]=t,this._fetchData()})).catch((e=>console.error("Kayıt güncelleme hatası:",e)))}})}}export{a as ComparisonFilter,i as Filter,o as FormManager,t as Include,g as LinqDataTable,f as LinqSelect2,r as LogicalFilter,n as Pager,e as Query,y as QueryBuilder,m as StateManager,s as ThenInclude,u as analyzePropertyType,d as buildFilter,l as debounce,c as defaults,h as fetchPagedData,p as fetchProperties};
